<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Recipes - Sourdough Bakery</title>
  <link rel="stylesheet" href="/css/styles.css">
  <script src="/js/api-service.js"></script>
</head>
<body>
  <header>
    <h1>Sourdough Bakery Web App</h1>
  </header>
  
  <nav>
    <ul>
      <li><a href="/dashboard.html">Dashboard</a></li>
      <li><a href="/recipes.html">Recipes</a></li>
      <li><a href="/tasks.html">Tasks</a></li>
      <li><a href="/starters.html">Starters</a></li>
      <li><a href="/timers.html">Timers</a></li>
      <li><a href="/ingredients.html">Ingredients</a></li>
      <li><a href="/profile.html">Profile</a></li>
      <li id="admin-link" style="display: none;"><a href="/admin.html">Admin Panel</a></li>
      <li><a href="#" id="logout-link">Logout</a></li>
    </ul>
  </nav>
  
  <div class="container">
    <div class="card">
      <h2>Recipes</h2>
      <div id="recipe-controls">
        <button id="add-recipe-btn" class="btn">Add New Recipe</button>
        <button id="import-recipes-btn" class="btn">Import Recipes</button>
        <button id="export-recipes-btn" class="btn">Export Recipes</button>
        <button id="clear-recipes-btn" class="btn btn-danger">Clear All Recipes</button>
        <input type="file" id="import-recipes-input" style="display: none;" accept=".csv,.json">
      </div>
      
      <div id="recipe-search">
        <input type="text" id="search-input" placeholder="Search recipes...">
        <select id="filter-select">
          <option value="all">All Categories</option>
          <option value="bread">Bread</option>
          <option value="pastry">Pastry</option>
          <option value="dessert">Dessert</option>
          <option value="other">Other</option>
        </select>
      </div>
      
      <div id="recipes-container">
        <p>Loading recipes...</p>
      </div>
    </div>
  </div>
  
  <!-- Recipe Form Modal -->
  <div id="recipe-form-modal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2 id="recipe-form-title">Add New Recipe</h2>
      <form id="recipe-form">
        <input type="hidden" id="recipe-id">
        
        <div class="form-group">
          <label for="recipe-name">Recipe Name</label>
          <input type="text" id="recipe-name" required>
        </div>
        
        <div class="form-group">
          <label for="recipe-description">Description</label>
          <textarea id="recipe-description" rows="3"></textarea>
        </div>
        
        <div class="form-group">
          <label for="recipe-category">Category</label>
          <select id="recipe-category">
            <option value="bread">Bread</option>
            <option value="pastry">Pastry</option>
            <option value="dessert">Dessert</option>
            <option value="other">Other</option>
          </select>
        </div>
        
        <div class="form-group">
          <label>Ingredients</label>
          <div id="ingredients-container">
            <!-- Ingredient inputs will be added here -->
          </div>
          <button type="button" id="add-ingredient-btn" class="btn btn-sm">Add Ingredient</button>
        </div>
        
        <div class="form-group">
          <label>Instructions</label>
          <div id="instructions-container">
            <!-- Instruction inputs will be added here -->
          </div>
          <button type="button" id="add-instruction-btn" class="btn btn-sm">Add Step</button>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="recipe-prep-time">Prep Time (minutes)</label>
            <input type="number" id="recipe-prep-time" min="0">
          </div>
          
          <div class="form-group">
            <label for="recipe-cook-time">Cook Time (minutes)</label>
            <input type="number" id="recipe-cook-time" min="0">
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="recipe-yield">Yield</label>
            <input type="text" id="recipe-yield">
          </div>
          
          <div class="form-group">
            <label for="recipe-difficulty">Difficulty</label>
            <select id="recipe-difficulty">
              <option value="easy">Easy</option>
              <option value="medium">Medium</option>
              <option value="hard">Hard</option>
            </select>
          </div>
        </div>
        
        <div class="form-group">
          <label for="recipe-tags">Tags (comma separated)</label>
          <input type="text" id="recipe-tags">
        </div>
        
        <div class="form-actions">
          <button type="submit" class="btn btn-primary">Save Recipe</button>
          <button type="button" id="cancel-recipe-btn" class="btn">Cancel</button>
        </div>
      </form>
    </div>
  </div>
  
  <!-- View Recipe Modal -->
  <div id="view-recipe-modal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2 id="view-recipe-name"></h2>
      <p id="view-recipe-description" class="recipe-description"></p>
      
      <div class="recipe-meta">
        <span id="view-recipe-category" class="recipe-category"></span>
        <span id="view-recipe-difficulty" class="recipe-difficulty"></span>
        <span id="view-recipe-prep-time" class="recipe-time"></span>
        <span id="view-recipe-cook-time" class="recipe-time"></span>
        <span id="view-recipe-yield" class="recipe-yield"></span>
      </div>
      
      <div class="recipe-scaling">
        <label for="scale-factor-input">Scale Recipe:</label>
        <input type="number" id="scale-factor-input" min="0.1" max="10" step="0.1" value="1">
        <button id="scale-recipe-btn" class="btn btn-sm">Scale</button>
      </div>
      
      <h3>Ingredients</h3>
      <ul id="view-recipe-ingredients" class="recipe-ingredients"></ul>
      
      <h3>Instructions</h3>
      <ol id="view-recipe-instructions" class="recipe-instructions"></ol>
      
      <div class="recipe-tags">
        <h3>Tags</h3>
        <div id="view-recipe-tags"></div>
      </div>
      
      <div class="recipe-actions">
        <button id="edit-recipe-btn" class="btn">Edit Recipe</button>
        <button id="delete-recipe-btn" class="btn btn-danger">Delete Recipe</button>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', async function() {
      // Check if user is logged in
      if (!ApiService.isLoggedIn()) {
        window.location.href = '/index.html';
        return;
      }
      
      // Get current user
      const currentUser = ApiService.getCurrentUser();
      
      // Show admin link if user is admin
      if (currentUser.role === 'admin') {
        document.getElementById('admin-link').style.display = 'block';
      }
      
      // Handle logout
      document.getElementById('logout-link').addEventListener('click', function(e) {
        e.preventDefault();
        ApiService.logout();
      });
      
      // DOM elements
      const recipesContainer = document.getElementById('recipes-container');
      const searchInput = document.getElementById('search-input');
      const filterSelect = document.getElementById('filter-select');
      const addRecipeBtn = document.getElementById('add-recipe-btn');
      const importRecipesBtn = document.getElementById('import-recipes-btn');
      const exportRecipesBtn = document.getElementById('export-recipes-btn');
      const clearRecipesBtn = document.getElementById('clear-recipes-btn');
      const importRecipesInput = document.getElementById('import-recipes-input');
      
      // Recipe form elements
      const recipeFormModal = document.getElementById('recipe-form-modal');
      const recipeForm = document.getElementById('recipe-form');
      const recipeFormTitle = document.getElementById('recipe-form-title');
      const recipeIdInput = document.getElementById('recipe-id');
      const recipeNameInput = document.getElementById('recipe-name');
      const recipeDescriptionInput = document.getElementById('recipe-description');
      const recipeCategorySelect = document.getElementById('recipe-category');
      const ingredientsContainer = document.getElementById('ingredients-container');
      const addIngredientBtn = document.getElementById('add-ingredient-btn');
      const instructionsContainer = document.getElementById('instructions-container');
      const addInstructionBtn = document.getElementById('add-instruction-btn');
      const recipePrepTimeInput = document.getElementById('recipe-prep-time');
      const recipeCookTimeInput = document.getElementById('recipe-cook-time');
      const recipeYieldInput = document.getElementById('recipe-yield');
      const recipeDifficultySelect = document.getElementById('recipe-difficulty');
      const recipeTagsInput = document.getElementById('recipe-tags');
      const cancelRecipeBtn = document.getElementById('cancel-recipe-btn');
      
      // View recipe elements
      const viewRecipeModal = document.getElementById('view-recipe-modal');
      const viewRecipeName = document.getElementById('view-recipe-name');
      const viewRecipeDescription = document.getElementById('view-recipe-description');
      const viewRecipeCategory = document.getElementById('view-recipe-category');
      const viewRecipeDifficulty = document.getElementById('view-recipe-difficulty');
      const viewRecipePrepTime = document.getElementById('view-recipe-prep-time');
      const viewRecipeCookTime = document.getElementById('view-recipe-cook-time');
      const viewRecipeYield = document.getElementById('view-recipe-yield');
      const viewRecipeIngredients = document.getElementById('view-recipe-ingredients');
      const viewRecipeInstructions = document.getElementById('view-recipe-instructions');
      const viewRecipeTags = document.getElementById('view-recipe-tags');
      const editRecipeBtn = document.getElementById('edit-recipe-btn');
      const deleteRecipeBtn = document.getElementById('delete-recipe-btn');
      const scaleFactorInput = document.getElementById('scale-factor-input');
      const scaleRecipeBtn = document.getElementById('scale-recipe-btn');
      
      // Close modals when clicking on the close button or outside the modal
      document.querySelectorAll('.modal .close').forEach(closeBtn => {
        closeBtn.addEventListener('click', function() {
          this.closest('.modal').style.display = 'none';
        });
      });
      
      window.addEventListener('click', function(event) {
        if (event.target.classList.contains('modal')) {
          event.target.style.display = 'none';
        }
      });
      
      // Load recipes
      let recipes = [];
      
      async function loadRecipes() {
        try {
          recipesContainer.innerHTML = '<p>Loading recipes...</p>';
          recipes = await ApiService.getRecipes();
          displayRecipes();
        } catch (error) {
          console.error('Error loading recipes:', error);
          recipesContainer.innerHTML = '<p>Error loading recipes. Please try again later.</p>';
        }
      }
      
      // Display recipes
      function displayRecipes(searchTerm = '', category = 'all') {
        let filteredRecipes = recipes;
        
        // Filter by search term
        if (searchTerm) {
          const term = searchTerm.toLowerCase();
          filteredRecipes = filteredRecipes.filter(recipe => 
            recipe.name.toLowerCase().includes(term) || 
            (recipe.description && recipe.description.toLowerCase().includes(term)) ||
            (recipe.tags && recipe.tags.some(tag => tag.toLowerCase().includes(term)))
          );
        }
        
        // Filter by category
        if (category !== 'all') {
          filteredRecipes = filteredRecipes.filter(recipe => recipe.category === category);
        }
        
        // Display recipes
        if (filteredRecipes.length === 0) {
          recipesContainer.innerHTML = '<p>No recipes found.</p>';
          return;
        }
        
        recipesContainer.innerHTML = '';
        
        filteredRecipes.forEach(recipe => {
          const recipeCard = document.createElement('div');
          recipeCard.className = 'recipe-card';
          recipeCard.innerHTML = `
            <h3>${recipe.name}</h3>
            <p>${recipe.description ? (recipe.description.substring(0, 100) + (recipe.description.length > 100 ? '...' : '')) : 'No description'}</p>
            <div class="recipe-meta">
              <span class="recipe-category">${recipe.category || 'Uncategorized'}</span>
              <span class="recipe-difficulty">${recipe.difficulty || 'N/A'}</span>
              ${recipe.prepTime ? `<span class="recipe-time">Prep: ${recipe.prepTime} min</span>` : ''}
              ${recipe.cookTime ? `<span class="recipe-time">Cook: ${recipe.cookTime} min</span>` : ''}
            </div>
            <button class="btn btn-sm view-recipe-btn" data-id="${recipe.id}">View Recipe</button>
          `;
          
          recipesContainer.appendChild(recipeCard);
          
          // Add event listener to view recipe button
          recipeCard.querySelector('.view-recipe-btn').addEventListener('click', function() {
            const recipeId = this.getAttribute('data-id');
            viewRecipe(recipeId);
          });
        });
      }
      
      // Search and filter recipes
      searchInput.addEventListener('input', function() {
        displayRecipes(this.value, filterSelect.value);
      });
      
      filterSelect.addEventListener('change', function() {
        displayRecipes(searchInput.value, this.value);
      });
      
      // Add new recipe
      addRecipeBtn.addEventListener('click', function() {
        showRecipeForm();
      });
      
      // Clear all recipes
      clearRecipesBtn.addEventListener('click', async function() {
        if (confirm('Are you sure you want to clear all recipes? This cannot be undone.')) {
          try {
            await ApiService.clearAllRecipes();
            recipes = [];
            displayRecipes();
            alert('All recipes cleared successfully.');
          } catch (error) {
            console.error('Error clearing recipes:', error);
            alert('Error clearing recipes. Please try again.');
          }
        }
      });
      
      // Show recipe form
      function showRecipeForm(recipe = null) {
        // Clear form
        recipeForm.reset();
        recipeIdInput.value = '';
        ingredientsContainer.innerHTML = '';
        instructionsContainer.innerHTML = '';
        
        // Set form title
        recipeFormTitle.textContent = recipe ? 'Edit Recipe' : 'Add New Recipe';
        
        // Fill form if editing
        if (recipe) {
          recipeIdInput.value = recipe.id;
          recipeNameInput.value = recipe.name || '';
          recipeDescriptionInput.value = recipe.description || '';
          recipeCategorySelect.value = recipe.category || 'other';
          recipePrepTimeInput.value = recipe.prepTime || '';
          recipeCookTimeInput.value = recipe.cookTime || '';
          recipeYieldInput.value = recipe.yield || '';
          recipeDifficultySelect.value = recipe.difficulty || 'medium';
          recipeTagsInput.value = recipe.tags ? recipe.tags.join(', ') : '';
          
          // Add ingredients
          if (recipe.ingredients && recipe.ingredients.length > 0) {
            recipe.ingredients.forEach(ingredient => {
              addIngredientInput(ingredient);
            });
          }
          
          // Add instructions
          if (recipe.instructions && recipe.instructions.length > 0) {
            recipe.instructions.forEach(instruction => {
              addInstructionInput(instruction);
            });
          }
        }
        
        // Add at least one ingredient and instruction input if none exist
        if (ingredientsContainer.children.length === 0) {
          addIngredientInput();
        }
        
        if (instructionsContainer.children.length === 0) {
          addInstructionInput();
        }
        
        // Show modal
        recipeFormModal.style.display = 'block';
      }
      
      // Add ingredient input
      function addIngredientInput(ingredient = { amount: '', unit: '', name: '' }) {
        const ingredientRow = document.createElement('div');
        ingredientRow.className = 'ingredient-row';
        ingredientRow.innerHTML = `
          <input type="number" class="ingredient-amount" placeholder="Amount" value="${ingredient.amount || ''}" step="0.01" min="0">
          <input type="text" class="ingredient-unit" placeholder="Unit" value="${ingredient.unit || ''}" list="unit-options">
          <input type="text" class="ingredient-name" placeholder="Ingredient" value="${ingredient.name || ''}" required>
          <button type="button" class="btn-icon remove-ingredient">&times;</button>
        `;
        
        // Add datalist for units
        if (!document.getElementById('unit-options')) {
          const datalist = document.createElement('datalist');
          datalist.id = 'unit-options';
          datalist.innerHTML = `
            <option value="g">
            <option value="kg">
            <option value="ml">
            <option value="mg">
            <option value="l">
            <option value="tsp">
            <option value="tbsp">
            <option value="cup">
            <option value="piece">
          `;
          document.body.appendChild(datalist);
        }
        
        ingredientsContainer.appendChild(ingredientRow);
        
        // Add event listener to remove button
        ingredientRow.querySelector('.remove-ingredient').addEventListener('click', function() {
          if (ingredientsContainer.children.length > 1) {
            ingredientRow.remove();
          }
        });
      }
      
      // Add instruction input
      function addInstructionInput(instruction = '') {
        const instructionRow = document.createElement('div');
        instructionRow.className = 'instruction-row';
        instructionRow.innerHTML = `
          <textarea class="instruction-text" placeholder="Instruction step" required>${instruction || ''}</textarea>
          <button type="button" class="btn-icon remove-instruction">&times;</button>
        `;
        
        instructionsContainer.appendChild(instructionRow);
        
        // Add event listener to remove button
        instructionRow.querySelector('.remove-instruction').addEventListener('click', function() {
          if (instructionsContainer.children.length > 1) {
            instructionRow.remove();
          }
        });
      }
      
      // Add ingredient button
      addIngredientBtn.addEventListener('click', function() {
        addIngredientInput();
      });
      
      // Add instruction button
      addInstructionBtn.addEventListener('click', function() {
        addInstructionInput();
      });
      
      // Cancel recipe button
      cancelRecipeBtn.addEventListener('click', function() {
        recipeFormModal.style.display = 'none';
      });
      
      // Save recipe
      recipeForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        // Get form data
        const recipeData = {
          name: recipeNameInput.value,
          description: recipeDescriptionInput.value,
          category: recipeCategorySelect.value,
          prepTime: recipePrepTimeInput.value ? parseInt(recipePrepTimeInput.value) : 0,
          cookTime: recipeCookTimeInput.value ? parseInt(recipeCookTimeInput.value) : 0,
          yield: recipeYieldInput.value,
          difficulty: recipeDifficultySelect.value,
          tags: recipeTagsInput.value ? recipeTagsInput.value.split(',').map(tag => tag.trim()) : []
        };
        
        // Get ingredients
        recipeData.ingredients = [];
        ingredientsContainer.querySelectorAll('.ingredient-row').forEach(row => {
          const amount = row.querySelector('.ingredient-amount').value;
          const unit = row.querySelector('.ingredient-unit').value;
          const name = row.querySelector('.ingredient-name').value;
          
          if (name) {
            recipeData.ingredients.push({
              amount: amount ? parseFloat(amount) : 0,
              unit,
              name
            });
          }
        });
        
        // Get instructions
        recipeData.instructions = [];
        instructionsContainer.querySelectorAll('.instruction-text').forEach(textarea => {
          const text = textarea.value.trim();
          if (text) {
            recipeData.instructions.push(text);
          }
        });
        
        try {
          // Save recipe
          if (recipeIdInput.value) {
            // Update existing recipe
            await ApiService.updateRecipe(recipeIdInput.value, recipeData);
          } else {
            // Create new recipe
            await ApiService.createRecipe(recipeData);
          }
          
          // Reload recipes
          await loadRecipes();
          
          // Hide modal
          recipeFormModal.style.display = 'none';
        } catch (error) {
          console.error('Error saving recipe:', error);
          alert('Error saving recipe. Please try again.');
        }
      });
      
      // View recipe
      async function viewRecipe(recipeId) {
        try {
          const recipe = recipes.find(r => r.id === recipeId);
          
          if (!recipe) {
            alert('Recipe not found.');
            return;
          }
          
          // Set recipe data
          viewRecipeName.textContent = recipe.name || 'Unnamed Recipe';
          viewRecipeDescription.textContent = recipe.description || 'No description';
          viewRecipeCategory.textContent = recipe.category || 'Uncategorized';
          viewRecipeDifficulty.textContent = `Difficulty: ${recipe.difficulty || 'N/A'}`;
          viewRecipePrepTime.textContent = recipe.prepTime ? `Prep: ${recipe.prepTime} min` : '';
          viewRecipeCookTime.textContent = recipe.cookTime ? `Cook: ${recipe.cookTime} min` : '';
          viewRecipeYield.textContent = recipe.yield ? `Yield: ${recipe.yield}` : '';
          
          // Set ingredients
          viewRecipeIngredients.innerHTML = '';
          if (recipe.ingredients && recipe.ingredients.length > 0) {
            recipe.ingredients.forEach(ingredient => {
              const li = document.createElement('li');
              li.innerHTML = `<span class="ingredient-amount">${ingredient.amount || ''}</span> <span class="ingredient-unit">${ingredient.unit || ''}</span> <span class="ingredient-name">${ingredient.name || ''}</span>`;
              viewRecipeIngredients.appendChild(li);
            });
          } else {
            viewRecipeIngredients.innerHTML = '<li>No ingredients listed.</li>';
          }
          
          // Set instructions
          viewRecipeInstructions.innerHTML = '';
          if (recipe.instructions && recipe.instructions.length > 0) {
            recipe.instructions.forEach(instruction => {
              const li = document.createElement('li');
              li.textContent = instruction;
              viewRecipeInstructions.appendChild(li);
            });
          } else {
            viewRecipeInstructions.innerHTML = '<li>No instructions listed.</li>';
          }
          
          // Set tags
          viewRecipeTags.innerHTML = '';
          if (recipe.tags && recipe.tags.length > 0) {
            recipe.tags.forEach(tag => {
              const tagSpan = document.createElement('span');
              tagSpan.className = 'tag';
              tagSpan.textContent = tag;
              viewRecipeTags.appendChild(tagSpan);
            });
          } else {
            viewRecipeTags.textContent = 'No tags.';
          }
          
          // Store original ingredients for scaling
          window.originalIngredients = recipe.ingredients ? [...recipe.ingredients] : [];
          
          // Reset scale factor
          scaleFactorInput.value = 1;
          
          // Set edit button event
          editRecipeBtn.onclick = function() {
            viewRecipeModal.style.display = 'none';
            showRecipeForm(recipe);
          };
          
          // Set delete button event
          deleteRecipeBtn.onclick = async function() {
            if (confirm(`Are you sure you want to delete "${recipe.name}"?`)) {
              try {
                await ApiService.deleteRecipe(recipe.id);
                viewRecipeModal.style.display = 'none';
                await loadRecipes();
              } catch (error) {
                console.error('Error deleting recipe:', error);
                alert('Error deleting recipe. Please try again.');
              }
            }
          };
          
          // Show modal
          viewRecipeModal.style.display = 'block';
        } catch (error) {
          console.error('Error viewing recipe:', error);
          alert('Error viewing recipe. Please try again.');
        }
      }
      
      // Scale recipe
      scaleRecipeBtn.addEventListener('click', function() {
        const factor = parseFloat(scaleFactorInput.value);
        const ingredientsList = viewRecipeIngredients;
        ingredientsList.innerHTML = '';
        
        if (!window.originalIngredients || window.originalIngredients.length === 0) {
          ingredientsList.innerHTML = '<li>No ingredients to scale.</li>';
          return;
        }
        
        window.originalIngredients.forEach(ingredient => {
          const scaledAmount = ingredient.amount ? (ingredient.amount * factor).toFixed(2) : '';
          
          const li = document.createElement('li');
          li.innerHTML = `<span class="ingredient-amount">${scaledAmount}</span> <span class="ingredient-unit">${ingredient.unit || ''}</span> <span class="ingredient-name">${ingredient.name || ''}</span>`;
          ingredientsList.appendChild(li);
        });
      });
      
      // Import recipes
      importRecipesBtn.addEventListener('click', function() {
        importRecipesInput.click();
      });
      
      importRecipesInput.addEventListener('change', async function(e) {
        const file = e.target.files[0];
        if (!file) return;
        
        const reader = new FileReader();
        
        reader.onload = async function(e) {
          try {
            const fileContent = e.target.result;
            
            if (file.name.endsWith('.json')) {
              // Parse JSON
              const importedRecipes = JSON.parse(fileContent);
              
              // Confirm import
              if (confirm(`Import ${Array.isArray(importedRecipes) ? importedRecipes.length : 1} recipes?`)) {
                // Import recipes
                if (Array.isArray(importedRecipes)) {
                  for (const recipe of importedRecipes) {
                    await ApiService.createRecipe(recipe);
                  }
                } else {
                  await ApiService.createRecipe(importedRecipes);
                }
                
                // Reload recipes
                await loadRecipes();
                
                alert(`Successfully imported ${Array.isArray(importedRecipes) ? importedRecipes.length : 1} recipes.`);
              }
            } else if (file.name.endsWith('.csv')) {
              // Import CSV
              try {
                const result = await ApiService.importRecipesFromCSV(fileContent);
                alert(result.message);
                await loadRecipes();
              } catch (error) {
                alert(`Error importing CSV: ${error.message}`);
              }
            } else {
              throw new Error('Unsupported file format. Please use JSON or CSV.');
            }
          } catch (error) {
            console.error('Error importing recipes:', error);
            alert(`Error importing recipes: ${error.message}`);
          }
          
          // Reset file input
          e.target.value = '';
        };
        
        reader.readAsText(file);
      });
      
      // Export recipes
      exportRecipesBtn.addEventListener('click', function() {
        if (recipes.length === 0) {
          alert('No recipes to export.');
          return;
        }
        
        const dataStr = JSON.stringify(recipes, null, 2);
        const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
        
        const exportFileDefaultName = 'recipes.json';
        
        const linkElement = document.createElement('a');
        linkElement.setAttribute('href', dataUri);
        linkElement.setAttribute('download', exportFileDefaultName);
        linkElement.click();
      });
      
      // Load recipes on page load
      loadRecipes();
    });
  </script>
</body>
</html>
